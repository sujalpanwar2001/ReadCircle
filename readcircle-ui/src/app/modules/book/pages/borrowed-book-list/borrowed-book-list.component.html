<div class="p-3">
  <h2 class="fw-bold mb-3">üìñ Books Borrowed By Me</h2>
  <hr />

  <!-- Feedback Form (when a book is selected) -->
  <div
    class="card shadow-sm border-0 col-lg-8 col-md-10 mx-auto mb-4"
    *ngIf="selectedBook"
  >
    <div class="card-body">
      <h4 class="fw-bold mb-3 text-success">
        <i class="fa-solid fa-arrow-rotate-left me-2"></i>
        Return & Share Feedback
      </h4>

      <!-- Selected Book Info -->
      <div class="mb-3">
        <p><strong>üìñ Title:</strong> {{ selectedBook.title }}</p>
        <p><strong>‚úçÔ∏è Author:</strong> {{ selectedBook.authorName }}</p>
        <p><strong>üîñ ISBN:</strong> {{ selectedBook.isbn }}</p>
        <p><strong>‚≠ê Current Rating:</strong> {{ selectedBook.rate }}</p>
      </div>

      <hr />

      <!-- Feedback Form -->
      <form class="row g-3">
        <!-- Rating -->
        <div class="d-flex align-items-center gap-3">
          <input
            [(ngModel)]="feedbackRequest.note"
            type="range"
            id="rate"
            name="rate"
            class="form-range w-25"
            min="0"
            max="5"
            step="0.5"
          />
          <app-rating [rating]="feedbackRequest.note || 0"></app-rating>
          <span class="badge bg-warning text-dark fs-6">{{
            feedbackRequest.note
          }}</span>
        </div>

        <!-- Comment -->
        <div class="col-12 mt-3">
          <label for="synopsis" class="form-label fw-bold">üí¨ Feedback</label>
          <textarea
            [(ngModel)]="feedbackRequest.comment"
            rows="4"
            class="form-control shadow-sm"
            id="synopsis"
            name="synopsis"
            placeholder="Share your experience with this book..."
          ></textarea>
        </div>

        <!-- Buttons -->
        <div class="d-flex justify-content-end gap-2 col-12 mt-3">
          <button
            (click)="returnBook(true)"
            type="submit"
            class="btn btn-outline-primary"
          >
            <i class="fas fa-save"></i>&nbsp; Rate & Return
          </button>
          <button
            (click)="returnBook(false)"
            type="submit"
            class="btn btn-outline-success"
          >
            <i class="fa-solid fa-paper-plane"></i>&nbsp; Just Return
          </button>
<a class="btn btn-outline-danger" (click)="selectedBook = undefined">
  <i class="fas fa-times"></i>&nbsp; Cancel
</a>

        </div>
      </form>
    </div>
  </div>

  <!-- Borrowed Books Table -->
  <div *ngIf="!selectedBook" class="table-responsive shadow-sm rounded-3">
    <table class="table align-middle table-hover mb-0">
      <thead class="table-light">
        <tr>
          <th scope="col">#</th>
          <th scope="col">Title</th>
          <th scope="col">Author</th>
          <th scope="col">ISBN</th>
          <th scope="col">Rating</th>
          <th scope="col" class="text-center">
            <i class="fas fa-cogs"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let book of borrowedBooks.content; let index = index">
          <th scope="row">{{ index + 1 }}</th>
          <td class="fw-semibold">{{ book.title }}</td>
          <td>{{ book.authorName }}</td>
          <td>{{ book.isbn }}</td>
          <td>
            <span class="badge bg-warning text-dark">
              <i class="fas fa-star"></i> {{ book.rate || 0 }}
            </span>
          </td>
          <td class="text-center">
            <div class="d-flex justify-content-center gap-3">
              <!-- Returned -->
              <i
                *ngIf="book.returned"
                class="fa-regular fa-paper-plane text-secondary"
                title="Already Returned"
              ></i>
              <!-- Return Action -->
              <i
                *ngIf="!book.returned"
                (click)="returnBorrowedBook(book)"
                class="fa-solid fa-paper-plane text-success cursor-pointer"
                title="Return Book"
              ></i>
              <!-- Return Status -->
              <i
                class="fa-solid fa-circle-check"
                [class.text-success]="book.returnApproved"
                [title]="
                  book.returnApproved ? 'Return Approved' : 'Waiting Approval'
                "
              ></i>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div
    class="pagination-footer bg-white shadow-sm border-top py-2 mt-2"
    
    *ngIf="borrowedBooks.content?.length && !selectedBook"
  >
    <nav class="d-flex justify-content-center">
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item">
          <a
            (click)="goToFirstPage()"
            class="page-link border-0"
            [class.disabled]="page === 0"
            href="javascript:void(0)"
          >
            <i class="fa-solid fa-angles-left"></i>
          </a>
        </li>
        <li class="page-item">
          <a
            (click)="goToPreviousPage()"
            class="page-link border-0"
            [class.disabled]="page === 0"
            href="javascript:void(0)"
          >
            <i class="fa-solid fa-angle-left"></i>
          </a>
        </li>

        <li class="page-item" *ngFor="let pageIndex of pages">
          <a
            (click)="gotToPage(pageIndex)"
            class="page-link border-0 rounded-pill"
            [class.active]="page === pageIndex"
            href="javascript:void(0)"
          >
            {{ pageIndex + 1 }}
          </a>
        </li>

        <li class="page-item">
          <a
            (click)="goToNextPage()"
            class="page-link border-0"
            [class.disabled]="isLastPage"
            href="javascript:void(0)"
          >
            <i class="fa-solid fa-chevron-right"></i>
          </a>
        </li>
        <li class="page-item">
          <a
            (click)="goToLastPage()"
            class="page-link border-0"
            [class.disabled]="isLastPage"
            href="javascript:void(0)"
          >
            <i class="fa-solid fa-angles-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
